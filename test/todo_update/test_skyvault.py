from openalea.ratp.skyvault import Skyvault
import numpy

def test_read():
    fn ='skyvaultsoc.skv'
    sky = Skyvault.read(fn)
    assert sky.ndir == 46
    
    expected_hmoy = numpy.array([ 0.16109389,  0.16109389,  0.16109389,  0.16109389,  0.16109389,
        0.16109389,  0.16109389,  0.16109389,  0.16109389,  0.16109389,
        0.1886701 ,  0.1886701 ,  0.1886701 ,  0.1886701 ,  0.1886701 ,
        0.46373397,  0.46373397,  0.46373397,  0.46373397,  0.46373397,
        0.54244834,  0.54244834,  0.54244834,  0.54244834,  0.54244834,
        0.54244834,  0.54244834,  0.54244834,  0.54244834,  0.54244834,
        0.82746059,  0.82746059,  0.82746059,  0.82746059,  0.82746059,
        0.91839224,  0.91839224,  0.91839224,  0.91839224,  0.91839224,
        1.20706975,  1.20706975,  1.20706975,  1.20706975,  1.20706975,
        1.57079637])
        
    numpy.testing.assert_allclose(sky.hmoy, expected_hmoy, atol=1e-4)

    
    assert sky
    
def test_initialise():

    sky = Skyvault.initialise()
    assert sky.ndir == 46
    expected_hmoy = numpy.array([ 0.16109389,  0.16109389,  0.16109389,  0.16109389,  0.16109389,
        0.16109389,  0.16109389,  0.16109389,  0.16109389,  0.16109389,
        0.1886701 ,  0.1886701 ,  0.1886701 ,  0.1886701 ,  0.1886701 ,
        0.46373397,  0.46373397,  0.46373397,  0.46373397,  0.46373397,
        0.54244834,  0.54244834,  0.54244834,  0.54244834,  0.54244834,
        0.54244834,  0.54244834,  0.54244834,  0.54244834,  0.54244834,
        0.82746059,  0.82746059,  0.82746059,  0.82746059,  0.82746059,
        0.91839224,  0.91839224,  0.91839224,  0.91839224,  0.91839224,
        1.20706975,  1.20706975,  1.20706975,  1.20706975,  1.20706975,
        1.57079637])
        
    numpy.testing.assert_allclose(sky.hmoy, expected_hmoy, atol=1e-4)
    sky = Skyvault.initialise(hmoy=90, azmoy=0, omega=2*numpy.pi, pc=1)
    assert sky.ndir == 1
    numpy.testing.assert_allclose(sky.hmoy, numpy.radians(90))
    
    